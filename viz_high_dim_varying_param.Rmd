---
title: "R Notebook"
output: html_notebook
---
```{r}
library(tidyverse)
library(plotly)
```


This notebook visualizes the simulation results that vary with a variable: var_param

```{r}
# to specify
# results_folder <- "results/highdim/binary/varyparams/varyalphaz/"
# var_param <- quo(alpha_z)
# results_folder <- "results/highdim/binary/varyparams/varyzeta/"
# var_param <- quo(zeta)
results_folder <- "results/highdim/binary/varyparams/varyp/"
var_param <- quo(p)

fl = list.files(results_folder, pattern = ".results.")
setwd(results_folder)
results <- bind_rows(lapply(fl, readRDS))
```

```{r}
results %>%
  dplyr::group_by(!! var_param, method) %>%
  dplyr::summarise(
    mmse = mean(mse),
    count = n(),
    vmse = var(mse),
    low = mean(mse) - 1.96 * sqrt(var(mse) / n()),
    high = mean(mse) + 1.96 * sqrt(var(mse) / n()), 
  ) 
```


```{r}
# results %>%
#   dplyr::mutate(method = factor(recode(results$method, 
#                                 bc = "BC",
#                                 bct = "Oracle BC",
#                                 conf = "BTR", 
#                                 pl = "PL"), 
#                 levels = rev(c("Oracle BC",
#                            "pl1se", 
#                            "conf1se",
#                            "BC",
#                            "PL", 
#                            "BTR"))))-> results
results %>%
  dplyr::group_by(!! var_param, method) %>%
  dplyr::filter(!(method %in% c("pl1se", "conf1se", "regression_diff", "bc_true_mu", "bc_true_prop"))) %>%
  dplyr::summarise(
    mmse = mean(mse),
    low = mean(mse) - 1.96 * sqrt(var(mse) / n()),
    high = mean(mse) + 1.96 * sqrt(var(mse) / n()), 
  ) %>% 
  ggplot(aes(x = !! var_param, y = mmse, color = method)) +
  geom_point() +
  geom_errorbar(aes(ymin = low, ymax = high), width = 0.5) +
  ylab("Mean Squared Error") + 
  #scale_x_continuous(breaks = c(10, 20, 30), minor_breaks = c(10, 20, 30)) +
 #xlab("q (dimensionality of confounding variable Z)") +
  theme_bw(base_size = 15)  -> mse_scatter

ggplotly(mse_scatter)
  #theme(legend.position = "bottom")
#ggsave("img/mse_varyq.pdf")
```

```{r}
results %>%
  dplyr::group_by(!! var_param, method) %>%
  dplyr::filter(!(method %in% c("pl1se", "conf1se"))) %>%
  dplyr::summarise(
    mmse = mean(mse),
    low = mean(mse) - 1.96 * sqrt(var(mse) / n()),
    high = mean(mse) + 1.96 * sqrt(var(mse) / n()), 
  ) %>%
  ggplot(aes(x = method, y = mmse, color = method, fill = method)) +
  geom_col() +
  geom_errorbar(aes(ymin = low, ymax = high)) +
  ylab("Mean Squared Error") + 
  facet_grid(rows = vars(!! var_param), scales = "free_y")
  theme_bw(base_size = 15)
#ggsave("img/binary_varying_rlang::as_name(var_param).pdf")
```