---
title: "R Notebook"
output: html_notebook
---
```{r}
library(tidyverse)
```


This notebook visualizes the simulation results  that vary dim_z

```{r}
results <- readRDS(glue::glue("results/highdim/expected/","results.Rds"))
parameters <- readRDS(glue::glue("results/highdim/expected/", "parameters.Rds"))

results %>% 
  dplyr::mutate(q = parameters$dim_z) -> results1

results <- readRDS(glue::glue("results/highdim/expected/","results.Rds"))
parameters <- readRDS(glue::glue("results/highdim/expected/", "parameters.Rds"))

results %>% 
  dplyr::mutate(q = parameters$dim_z) -> results0

results <- bind_rows(results0, results1)
```

```{r}
results %>%
  dplyr::group_by(q, method) %>%
  dplyr::summarise(
    mmse = mean(mse),
    count = n(),
    vmse = var(mse),
    low = mean(mse) - 1.96 * sqrt(var(mse) / n()),
    high = mean(mse) + 1.96 * sqrt(var(mse) / n()), 
  ) 
```

```{r}
parameters
```

Note that for alpha <= 20, the propensity function is solely determined by Z. Since in this case we no longer have a collider structure, it makes sense that the confounded model does better than it does when we do have the collider. The propensity function is also easier to estimate so the BC model does better.
I am not sure that it makes sense that the plugin does better at 20 than 45 since the propensity scores are not that different??

```{r}
results %>%
  dplyr::group_by(alpha, method) %>%
  dplyr::filter(!(method %in% c("pl1se", "conf1se"))) %>%
  dplyr::summarise(
    mmse = mean(mse),
    low = mean(mse) - 1.96 * sqrt(var(mse) / n()),
    high = mean(mse) + 1.96 * sqrt(var(mse) / n()), 
  ) %>%
  ggplot(aes(x = alpha, y = mmse, color = method)) +
  geom_point() +
  geom_errorbar(aes(ymin = low, ymax = high)) +
  ylab("Mean Squared Error")
#ggsave("img/mse.pdf")
```